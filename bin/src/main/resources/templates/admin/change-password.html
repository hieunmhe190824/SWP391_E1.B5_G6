<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đổi mật khẩu - Car Rental System</title>

    <!-- ===== CSS FILES ===== -->
    <link rel="stylesheet" th:href="@{/css/variables.css}">
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/components.css}">
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">
    <link rel="stylesheet" th:href="@{/css/profile.css}">
    <style>
        .required {
            color: var(--color-danger, #dc3545);
        }
    </style>
</head>

<body>
    <!-- ===== DASHBOARD LAYOUT ===== -->
    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside th:replace="~{fragments/components/sidebar-admin :: sidebar-admin}"></aside>

        <!-- Sidebar Overlay (Mobile) -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Main Content -->
        <div class="dashboard-main">
            <!-- Header -->
            <header th:replace="~{fragments/components/dashboard-header :: dashboard-header}"></header>

            <!-- Page Content -->
            <main class="dashboard-content">
                <section class="page-card">
                    <div class="page-container">
                        <div class="page-card-header">
                            <h2>Đổi mật khẩu</h2>
                            <p class="page-card-description">Cập nhật mật khẩu của bạn để bảo mật tài khoản</p>
                        </div>
                        <div class="page-card-body">
                            <!-- Flash Messages -->
                            <div th:if="${success}">
                                <div th:replace="~{fragments/components/messages :: success(${success})}"></div>
                            </div>
                            <div th:if="${error}">
                                <div th:replace="~{fragments/components/messages :: error(${error})}"></div>
                            </div>

                            <form id="changePasswordForm" th:action="@{/admin/profile/change-password}" method="post">
                                <div class="form-group">
                                    <label for="currentPassword">Mật khẩu hiện tại <span
                                            class="required">*</span></label>
                                    <input type="password" id="currentPassword" name="currentPassword"
                                        class="form-control" required>
                                </div>

                                <div class="form-row">
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label for="newPassword">Mật khẩu mới <span
                                                    class="required">*</span></label>
                                            <input type="password" id="newPassword" name="newPassword"
                                                class="form-control" required minlength="6">
                                            <small class="form-text">Mật khẩu phải có ít nhất 6 ký tự</small>
                                        </div>
                                    </div>
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label for="confirmPassword">Xác nhận mật khẩu mới <span
                                                    class="required">*</span></label>
                                            <input type="password" id="confirmPassword" name="confirmPassword"
                                                class="form-control" required minlength="6">
                                            <small class="form-text error-message" id="passwordMatchError"
                                                style="display: none; color: var(--color-danger);">Mật khẩu xác nhận
                                                không khớp</small>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-button">
                                    <button type="submit" class="btn btn-primary">Đổi mật khẩu</button>
                                    <a th:href="@{/admin/profile}" class="btn btn-secondary"
                                        style="margin-left: 0.5rem;">Hủy</a>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>
            </main>

            <!-- Footer -->
            <footer th:replace="~{fragments/footer :: footer}"></footer>
        </div>
    </div>

    <!-- Scripts -->
    <div th:replace="~{fragments/components/dashboard-header :: dashboard-scripts}"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const newPasswordInput = document.getElementById('newPassword');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const errorMsg = document.getElementById('passwordMatchError');
            const form = document.getElementById('changePasswordForm');

            // Validate password match on input
            confirmPasswordInput.addEventListener('input', function () {
                const newPassword = newPasswordInput.value;
                const confirmPassword = this.value;

                if (confirmPassword && newPassword !== confirmPassword) {
                    errorMsg.style.display = 'block';
                } else {
                    errorMsg.style.display = 'none';
                }
            });

            // Validate on form submit
            form.addEventListener('submit', function (e) {
                const newPassword = newPasswordInput.value;
                const confirmPassword = confirmPasswordInput.value;

                if (newPassword !== confirmPassword) {
                    e.preventDefault();
                    errorMsg.style.display = 'block';
                    confirmPasswordInput.focus();
                    return false;
                }
            });
        });
    </script>
</body>

</html>