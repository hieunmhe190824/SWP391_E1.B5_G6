<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
    th:replace="~{fragments/auth-layout :: auth-layout('Quên mật khẩu - Car Rental System', ~{::authForm})}">

<div th:fragment="authForm">
    <!-- Form Icon -->
    <div class="form-icon">
        <div class="icon-holder">
            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
        </div>
    </div>

    <!-- Form Title -->
    <h3 class="form-title-center">Quên mật khẩu</h3>
    <p style="text-align: center; color: var(--text-secondary); margin-bottom: var(--spacing-xl);">
        Nhập email của bạn để nhận mật khẩu mới
    </p>

    <!-- Messages -->
    <div th:if="${error}">
        <div th:replace="~{fragments/components/messages :: error(${error})}"></div>
    </div>

    <!-- Forgot Password Form -->
    <form th:action="@{/auth/forgot-password}" method="post" id="forgotPasswordForm" onsubmit="return preventDoubleSubmit(this)">
        <!-- Email Input -->
        <div
            th:replace="~{fragments/components/forms :: input-email('Email', 'email', null, true, 'Nhập email đã đăng ký')}">
        </div>

        <!-- Submit Button -->
        <div class="form-button">
            <button type="submit" class="btn btn-primary" id="submitBtn">
                <span>Gửi mật khẩu mới</span>
            </button>
        </div>
    </form>

    <script>
        // Prevent double form submission
        let isSubmitting = false;
        
        function preventDoubleSubmit(form) {
            if (isSubmitting) {
                return false;
            }
            
            const submitBtn = document.getElementById('submitBtn');
            if (submitBtn) {
                isSubmitting = true;
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<span>Đang gửi...</span>';
            }
            
            return true;
        }
    </script>

    <!-- Links -->
    <div style="margin-top: var(--spacing-xl); text-align: center;">
        <p>
            Nhớ mật khẩu?
            <a th:href="@{/auth/login}">Đăng nhập</a>
        </p>
        <p style="margin-top: var(--spacing-md);">
            Chưa có tài khoản?
            <a th:href="@{/auth/register}">Đăng ký ngay</a>
        </p>
    </div>
</div>

</html>